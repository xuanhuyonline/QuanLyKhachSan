create database QLKS
use QLKS


 CREATE TABLE PHONG
(
 MAPHONG CHAR(11) NOT NULL PRIMARY KEY,
 TENPHONG NVARCHAR(20) ,
 LOAIPHONG NVARCHAR(20),
 GIAPHONG INT,
 TINHTRANG NVARCHAR(20),
 CHUTHICH NVARCHAR(50) 
  )

 CREATE TABLE HOADON
(
 MAHD CHAR(11) NOT NULL PRIMARY KEY,
 MAKH CHAR(11) NOT NULL,
 MANV CHAR(11) NOT NULL,
 NGAY INT,
 GIAHD INT,
)

CREATE TABLE  KHACHHANG
(
 MAKH CHAR(11),
 TENKH NVARCHAR(30),
 GIOITINH NVARCHAR(3),
 SDT CHAR(11),
 MAPHONG CHAR(11),
 CONSTRAINT PK_KH PRIMARY KEY(MAKH)
 )



CREATE TABLE  NHANVIEN
(
 MANV CHAR(11) NOT NULL PRIMARY KEY(MANV),
 TENNV NVARCHAR(20) ,
 CHUCVU NVARCHAR(50),
 LUONGNV float,
 GIOITINH NVARCHAR(3),
 CHUTHICH NVARCHAR(50)
 )

 CREATE TABLE DICHVU
(
 MADV CHAR(11) NOT NULL,
 MAKH CHAR(11) NOT NULL,
 GAGAN INT,
 MUCKHO INT,
 CUABE INT,
 MATXA INT,
 TONGTIENDV FLOAT,
 CONSTRAINT PK_DICHVU PRIMARY KEY(MADV)
)

ALTER TABLE DICHVU
ADD CONSTRAINT FK_DV_KH FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
ALTER TABLE KHACHHANG
ADD CONSTRAINT FK_KH_PHONG FOREIGN KEY(MAPHONG) REFERENCES PHONG(MAPHONG)
ALTER TABLE HOADON
ADD CONSTRAINT FK_HD_KH FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
ALTER TABLE HOADON
ADD CONSTRAINT FK_HD_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
------------------------------------------------------------------------------------------------------

SELECT * FROM PHONG
INSERT INTO PHONG
VALUES ('MP001',N'Phòng VIP',N'VIP',1000000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP002',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP003',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP004',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP005',N'Phòng VIP',N'VIP',1000000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP006',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP007',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP008',N'Phòng VIP',N'VIP',1000000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP009',N'Phòng VIP',N'VIP',1000000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP010',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP011',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP012',N'Phòng VIP',N'VIP',1000000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP013',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP014',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP015',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP016',N'Phòng VIP',N'VIP',1000000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP017',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP018',N'Phòng VIP',N'VIP',1000000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP019',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP020',N'Phòng VIP',N'VIP',1000000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP021',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP022',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP023',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP024',N'Phòng VIP',N'VIP',1000000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP025',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP026',N'Phòng Đơn',N'Đơn',500000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP027',N'Phòng VIP',N'VIP',1000000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP028',N'Phòng VIP',N'VIP',1000000,1,N'Còn Phòng')
INSERT INTO PHONG
VALUES ('MP029',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')
INSERT INTO PHONG
VALUES ('MP030',N'Phòng Đôi',N'Đôi',800000,0,N'Đã Đặt')


INSERT INTO KHACHHANG
VALUES ('KH001',N'Nguyễn Đồng Triều',N'Nam','0987678765','MP002')
INSERT INTO KHACHHANG
VALUES ('KH002',N'Lê Nhân Sinh',N'Nam','0934578712','MP004')
INSERT INTO KHACHHANG
VALUES ('KH003',N'Lê Thị Hoa',N'Nữ','0769878235','MP005')
INSERT INTO KHACHHANG
VALUES ('KH004',N'Lê Thanh Thúy',N'Nữ','0785678197','MP008')
INSERT INTO KHACHHANG
VALUES ('KH005',N'Trần Minh Khang',N'Nam','0765128765','MP010')
INSERT INTO KHACHHANG
VALUES ('KH006',N'Nguyễn Anh Khoa',N'Nam','0957820985','MP011')
INSERT INTO KHACHHANG
VALUES ('KH007',N'Nguyễn Như Tiên',N'Nữ','0769823475','MP014')
INSERT INTO KHACHHANG
VALUES ('KH008',N'Lê Thị Cúc',N'Nữ','0723678712','MP016')
INSERT INTO KHACHHANG
VALUES ('KH009',N'Cù Khang Minh',N'Nam','098734798','MP018')
INSERT INTO KHACHHANG
VALUES ('KH010',N'Nguyễn Anh Khoa',N'Nam','0912481278','MP019')
INSERT INTO KHACHHANG
VALUES ('KH011',N'Nguyễn Văn Ánh',N'Nam','0975128765','MP021')
INSERT INTO KHACHHANG
VALUES ('KH012',N'Nguyễn Anh Đức',N'Nam','0918823875','MP023')
INSERT INTO KHACHHANG
VALUES ('KH013',N'Trần Bích Nữ',N'Nữ','0339975437','MP024')
INSERT INTO KHACHHANG
VALUES ('KH014',N'Lê Thị Ánh Nga',N'Nữ','0339649712','MP027')
INSERT INTO KHACHHANG
VALUES ('KH015',N'Võ Hoàng Hải',N'Nam','098719793','MP029')
INSERT INTO KHACHHANG
VALUES ('KH016',N'Nguyễn Văn Tài',N'Nam','0986528778','MP030')

SELECT * FROM KHACHHANG


INSERT INTO NHANVIEN
VALUES ('NV001',N'Nguyễn  Công Trí',N'Nhân Viên',600000,N'Nam','S')
INSERT INTO NHANVIEN
VALUES ('NV002',N'Trần Thị Hằng',N'Nhân Viên',600000,N'Nữ','J')
INSERT INTO NHANVIEN
VALUES ('NV003',N'Nguyễn Kim Dung',N'Nhân Viên',600000,N'Nữ','J')
INSERT INTO NHANVIEN
VALUES ('NV004',N'Cao Bá Trung',N'Nhân Viên',600000,N'Nữ','K')
INSERT INTO NHANVIEN
VALUES ('NV005',N'Long Nhật Hoàng',N'Nhân Viên',600000,N'Nữ','S')
INSERT INTO NHANVIEN
VALUES ('NV006',N'Lê Nhật Trường',N'Nhân Viên',600000,N'Nam','K')
INSERT INTO NHANVIEN
VALUES ('NV007',N'Nguyễn Thị Đào',N'Nhân Viên',600000,N'Nữ','S')
INSERT INTO NHANVIEN
VALUES ('NV008',N'Lê Nhất Thống',N'Nhân Viên',600000,N'Nam','K')
INSERT INTO NHANVIEN
VALUES ('NV009',N'Hà Nguyễn Linh',N'Nhân Viên',600000,N'Nữ','S')
INSERT INTO NHANVIEN
VALUES ('NV010',N'Trần Văn Khanh',N'Nhân Viên',600000,N'Nam','J')
INSERT INTO NHANVIEN
VALUES ('NV011',N'Nguyễn Anh Hoàng',N'Nhân Viên',600000,N'Nam','S')
INSERT INTO NHANVIEN
VALUES ('NV012',N'Trần Thị Sen',N'Nhân Viên',600000,N'Nữ','J')
INSERT INTO NHANVIEN
VALUES ('NV013',N'Lê Kim Chi',N'Nhân Viên',600000,N'Nữ','J')
INSERT INTO NHANVIEN
VALUES ('NV014',N'Trần Thị Hà',N'Nhân Viên',600000,N'Nữ','K')
INSERT INTO NHANVIEN
VALUES ('NV015',N'Hà Mỹ Anh',N'Nhân Viên',600000,N'Nữ','S')
INSERT INTO NHANVIEN
VALUES ('NV016',N'Nguyễn Trường An',N'Nhân Viên',600000,N'Nam','K')
INSERT INTO NHANVIEN
VALUES ('NV017',N'Nguyễn Như Quỳnh',N'Nhân Viên',600000,N'Nữ','S')
INSERT INTO NHANVIEN
VALUES ('NV018',N'Lê Văn Pháp',N'Nhân Viên',600000,N'Nam','K')
INSERT INTO NHANVIEN
VALUES ('NV019',N'Cao Thị Trang',N'Nhân Viên',600000,N'Nữ','S')
INSERT INTO NHANVIEN
VALUES ('NV020',N'Trần Văn Thắng',N'Nhân Viên',600000,N'Nam','J')

SELECT MANV FROM NHANVIEN WHERE MANV = 'NV011105'


--SELECT COUNT(*) AS SL
--FROM NHANVIEN
--WHERE MANV='NV019'
--GROUP BY MANV

--CREATE PROCEDURE KT_THEMNV @MANV NCHAR(11)
--AS
--	BEGIN 
--		SELECT COUNT(*) AS SL
--		FROM NHANVIEN
--		WHERE MANV=@MANV
--		GROUP BY MANV
--	END
------------------------------------------------------------



INSERT INTO DICHVU
VALUES ('DV001','KH001',1,2,1,1,600000)
INSERT INTO DICHVU
VALUES ('DV002','KH002',2,2,2,1,800000)
INSERT INTO DICHVU
VALUES ('DV003','KH003',4,2,4,1,1200000)
INSERT INTO DICHVU
VALUES ('DV004','KH004',1,2,1,2,800000)
INSERT INTO DICHVU
VALUES ('DV005','KH005',1,2,1,1,600000)
INSERT INTO DICHVU
VALUES ('DV006','KH006',2,2,1,1,720000)
INSERT INTO DICHVU
VALUES ('DV007','KH007',1,2,3,2,960000)
INSERT INTO DICHVU
VALUES ('DV008','KH008',1,2,1,1,600000)
INSERT INTO DICHVU
VALUES ('DV009','KH009',2,1,3,1,780000)
INSERT INTO DICHVU
VALUES ('DV010','KH010',1,1,1,1,700000)
INSERT INTO DICHVU
VALUES ('DV011','KH011',1,2,2,1,680000)
INSERT INTO DICHVU
VALUES ('DV012','KH012',2,4,2,1,1000000)
INSERT INTO DICHVU
VALUES ('DV013','KH013',1,2,4,1,840000)
INSERT INTO DICHVU
VALUES ('DV014','KH014',2,2,3,2,1080000)
INSERT INTO DICHVU
VALUES ('DV015','KH015',1,4,1,1,800000)
INSERT INTO DICHVU
VALUES ('DV016','KH016',2,2,2,1,800000)

SELECT * FROM DICHVU
UPDATE DICHVU
SET TONGTIENDV= GAGAN*120000 + MUCKHO*100000 +CUABE*80000 +MATXA*200000

SELECT * FROM HOADON

INSERT INTO HOADON
VALUES ('HD001','KH001','NV002',20,16000000)
INSERT INTO HOADON
VALUES ('HD002','KH002','NV010',5,4000000)
INSERT INTO HOADON
VALUES ('HD003','KH003','NV011',23,23000000)
INSERT INTO HOADON
VALUES ('HD004','KH004','NV020',8,8000000)
INSERT INTO HOADON
VALUES ('HD005','KH005','NV003',24,19200000)
INSERT INTO HOADON
VALUES ('HD006','KH006','NV015',19,15200000)
INSERT INTO HOADON
VALUES ('HD007','KH007','NV016',21,16800000)
INSERT INTO HOADON
VALUES ('HD008','KH008','NV007',17,17000000)
INSERT INTO HOADON
VALUES ('HD009','KH009','NV013',26,26000000)
INSERT INTO HOADON
VALUES ('HD010','KH010','NV004',21,16800000)
INSERT INTO HOADON
VALUES ('HD011','KH011','NV001',2,1600000)
INSERT INTO HOADON
VALUES ('HD012','KH012','NV005',18,14400000)
INSERT INTO HOADON
VALUES ('HD013','KH013','NV006',12,12000000)
INSERT INTO HOADON
VALUES ('HD014','KH014','NV012',31,31000000)
INSERT INTO HOADON
VALUES ('HD015','KH015','NV008',15,12000000)
INSERT INTO HOADON
VALUES ('HD016','KH016','NV009',4,3200000)
UPDATE HOADON
SET GIAHD=NGAY*(SELECT GIAPHONG FROM KHACHHANG,PHONG WHERE KHACHHANG.MAPHONG=PHONG.MAPHONG AND HOADON.MAKH = KHACHHANG.MAKH)
SELECT * FROM HOADON

----------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE ThemNhanVien @MANV NCHAR(11), @TENNV NCHAR(20), @CHUCVU NVARCHAR(50),@LUONGNV float,@GIOITINH NCHAR(3),@CHUTHICH NVARCHAR(50)
AS
	BEGIN 
		INSERT INTO NHANVIEN
		VALUES (@MANV,@TENNV,@CHUCVU,@LUONGNV,@GIOITINH,@CHUTHICH)
	END

CREATE PROCEDURE SuaNhanVien @MANV NCHAR(11), @TENNV NCHAR(20), @CHUCVU NVARCHAR(50),@LUONGNV float,@GIOITINH NCHAR(3),@CHUTHICH NVARCHAR(50)
AS
	BEGIN
		UPDATE NHANVIEN
		SET TENNV=@TENNV,CHUCVU=@CHUCVU,LUONGNV=@LUONGNV,GIOITINH=@GIOITINH,CHUTHICH=@CHUTHICH
		WHERE MANV=@MANV
	END

CREATE PROCEDURE XoaNhanVien @MANV CHAR(11)
AS
	BEGIN
		DELETE FROM NHANVIEN
		WHERE MANV=@MANV
	END

CREATE PROCEDURE FindTenNV @TenNV NVARCHAR(20)
AS
	BEGIN
		SELECT *
		FROM NHANVIEN
		WHERE TENNV like @TenNV
	END

---------------------------------------------------------------------
CREATE PROCEDURE ThemKhachHang @MAKH CHAR(11), @TENKH NCHAR(20), @GIOITINH NVARCHAR(3),@SDT CHAR(15),@MAPHONG CHAR(10)
AS
	BEGIN 
		INSERT INTO KHACHHANG
		VALUES (@MAKH,@TENKH,@GIOITINH,@SDT,@MAPHONG)
	END

CREATE PROCEDURE SuaKhachHang @MAKH CHAR(11), @TENKH NCHAR(20), @GIOITINH NVARCHAR(3),@SDT CHAR(15),@MAPHONG CHAR(10)
AS
	BEGIN 
		UPDATE KHACHHANG
		SET TENKH=@TENKH,GIOITINH=@GIOITINH,SDT=@SDT,MAPHONG=@MAPHONG
		WHERE MAKH=@MAKH
	END

CREATE PROCEDURE XoaKhachHang @MAKH CHAR(11)
AS
	BEGIN
		DELETE FROM KHACHHANG
		WHERE MAKH=@MAKH
	END

CREATE PROCEDURE FindTenKH @TenKH NVARCHAR(20)
AS
	BEGIN
		SELECT *
		FROM KHACHHANG
		WHERE TENKH like @TenKH
	END
----------------------------------------------------------------------------------
CREATE PROCEDURE ThemPhong @MAPHONG CHAR(11), @TENPHONG NCHAR(20), @LOAIPHONG CHAR(10),@GIAPHONG float,@TINHTRANG nCHAR(20),@CHUTHICH NVARCHAR(50) 
AS
	BEGIN 
		INSERT INTO PHONG
		VALUES (@MAPHONG,@TENPHONG,@LOAIPHONG,@GIAPHONG,@TINHTRANG,@CHUTHICH)
	END
select *
from PHONG
CREATE PROCEDURE SuaPhong @MAPHONG CHAR(11), @TENPHONG NCHAR(20), @LOAIPHONG CHAR(10),@GIAPHONG float,@TINHTRANG nCHAR(20),@CHUTHICH NVARCHAR(50)
AS
	BEGIN 
		UPDATE PHONG
		SET TENPHONG=@TENPHONG,LOAIPHONG=@LOAIPHONG,GIAPHONG=@GIAPHONG,TINHTRANG=@TINHTRANG,CHUTHICH=@CHUTHICH
		WHERE MAPHONG=@MAPHONG
	END
CREATE PROCEDURE XoaPhong @MAPHONG CHAR(11)
AS
	BEGIN
		DELETE FROM PHONG
		WHERE MAPHONG=@MAPHONG
	END

CREATE PROCEDURE FindPhong @LoaiPhong NVARCHAR(10)
AS
	BEGIN
		SELECT *
		FROM PHONG
		WHERE LOAIPHONG like @LoaiPhong
	END

CREATE PROCEDURE FindPhongTrong @TinhTrang CHAR(10)
AS
	BEGIN
		SELECT *
		FROM PHONG
		WHERE TINHTRANG=@TinhTrang
	END


CREATE PROCEDURE DatPhong @MAPHONG CHAR(11)
AS
	BEGIN 
		UPDATE PHONG
		SET TINHTRANG='0', CHUTHICH=N'Đã Đặt'
		WHERE MAPHONG=@MAPHONG
	END
---------------------------------------------------------------------------------
CREATE PROCEDURE ThemDichVu @MADV CHAR(11), @MAKH CHAR(11), @GAGAN int,@MUCKHO int,@CUABE int,@MATXA int,@TONGTIENDV float
AS
	BEGIN 
		INSERT INTO DICHVU
		VALUES (@MADV,@MAKH,@GAGAN,@MUCKHO,@CUABE,@MATXA,@TONGTIENDV)
	END

CREATE PROCEDURE SuaDichVu @MADV CHAR(11),@GAGAN int,@MUCKHO int,@CUABE int,@MATXA int,@TONGTIENDV float
AS
	BEGIN 
		UPDATE DICHVU
		SET GAGAN=@GAGAN,MUCKHO=@MUCKHO,CUABE=@CUABE,MATXA=@MATXA,TONGTIENDV=@TONGTIENDV
		WHERE MADV=@MADV
	END

CREATE PROCEDURE XoaDichVu @MADV CHAR(11)
AS
	BEGIN
		DELETE FROM DICHVU
		WHERE MADV=@MADV
	END

CREATE PROCEDURE FindMaDV @MADV CHAR(10)
AS
	BEGIN
		SELECT *
		FROM DICHVU
		WHERE MADV like @MADV
	END

-----------------------------------------------------------------------------
CREATE PROCEDURE ThemHoaDon @MAHD CHAR(20), @MAKH CHAR(20),@MANV CHAR(20), @SONGAY INT, @TONGHD INT
AS
	BEGIN 
		INSERT INTO HOADON
		VALUES (@MAHD,@MAKH,@MANV,@SONGAY,@TONGHD)
	END

CREATE PROCEDURE XoaHoaDon @MAHD CHAR(11)
AS
	BEGIN
		DELETE FROM HOADON
		WHERE MAHD=@MAHD
	END



CREATE PROCEDURE SuaHoaDon @MAHD CHAR(20), @MAKH CHAR(20),@MANV CHAR(20), @SONGAY INT
AS
	BEGIN
		UPDATE HOADON
		SET MAKH=@MAKH,@MANV=@MANV, NGAY=@SONGAY,GIAHD=@SONGAY*(SELECT GIAPHONG FROM KHACHHANG,PHONG WHERE KHACHHANG.MAPHONG=PHONG.MAPHONG AND HOADON.MAKH = KHACHHANG.MAKH)
		WHERE MAHD=@MAHD AND MAKH=@MAKH
	END

SELECT * FROM HOADON
--exec SuaHoaDon 'HD016','KH016','NV016',4

CREATE PROCEDURE FindMaHD @MAHD CHAR(10)
AS
	BEGIN
		SELECT *
		FROM HOADON
		WHERE MAHD like @MAHD
	END

